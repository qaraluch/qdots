# Zshrc config file.
# Do not change the order of execution!

# Tmux autostart
if command -v tmux &> /dev/null && [ -n "$PS1" ] && [[ ! "$TERM" =~ screen ]] && [[ ! "$TERM" =~ tmux ]] && [ -z "$TMUX" ]; then
  exec tmux-init # see: ~/bin
fi

# Source qdots functions
for file ($QDOTS_FUNCTIONS_DIR/*.{sh,zsh}) source $file

# Prompt
[ -f "$QDOTS_ZSH_CONF_DIR/.zshrc-prompt" ] && source "$QDOTS_ZSH_CONF_DIR/.zshrc-prompt"

# Plugins
# see: run_once_zsh_setup.sh
[[ -d ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-syntax-highlighting ]] && source ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
[[ -d ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-vimto ]] && source ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-vimto/zsh-vimto.zsh
[[ -d ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-autosuggestions ]] && source ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-autosuggestions/zsh-autosuggestions.zsh
[[ -d ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-abbrev-alias ]] && source ${QDOTS_ZSH_CACHE_PLUGS_DIR}/zsh-abbrev-alias/abbrev-alias.plugin.zsh

# Ricing
# see: .local/share/rice
# see: wiki of pywal repo
[ -f "${QDOTS_RICE_SCRIPT}" ] && source "${QDOTS_RICE_SCRIPT}"
[ -f "${QDOTS_RICE_SEQUCENCES}" ] && (cat "${QDOTS_RICE_SEQUCENCES}" &)

# Fzf configuration
# no need for FZF_DEFAULT_OPTS
# generated by pywal and sourced by QDOTS_RICE_SCRIPT
source /usr/share/fzf/completion.zsh
source /usr/share/fzf/key-bindings.zsh

export FZF_DEFAULT_COMMAND='ag --follow --hidden --ignore .git --ignore node_modules --ignore .cache -g ""'
export FZF_CTRL_T_COMMAND='ag --follow --hidden --ignore .git --ignore node_modules --ignore .cache -g "" | sed -e "s:/[^/]*$::" | uniq'
export FZF_ALT_C_OPTS="--preview ' tree -C {} | head -200'"
export FZF_DEFAULT_OPTS='
    --color fg:59,bg:236,hl:99,fg+:188,bg+:236,hl+:226
    --color info:59,prompt:226,spinner:135,pointer:226,marker:118
'

# LS fix
# no need for LS_COLORS
# generated by pywal and sourced by QDOTS_RICE_SCRIPT

# Zsh-autosuggestions configuration
export ZSH_AUTOSUGGEST_USE_ASYNC='y'    # async suggestions

# Zsh-syntax-highlighting configuration
export ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets)
typeset -xA ZSH_HIGHLIGHT_STYLES
ZSH_HIGHLIGHT_STYLES[unknown-token]='fg=007'              # white
ZSH_HIGHLIGHT_STYLES[alias]='fg=191'                      # greenish
ZSH_HIGHLIGHT_STYLES[arg0]='fg=191'
ZSH_HIGHLIGHT_STYLES[command]='fg=191'
ZSH_HIGHLIGHT_STYLES[function]='fg=191'
ZSH_HIGHLIGHT_STYLES[single-hyphen-option]='fg=230'       # orangish
ZSH_HIGHLIGHT_STYLES[double-hyphen-option]='fg=230'
ZSH_HIGHLIGHT_STYLES[redirection]='fg=yellow'
ZSH_HIGHLIGHT_STYLES[path]='fg=cyan'
ZSH_HIGHLIGHT_STYLES[comment]='fg=225'                    # light purplish
ZSH_HIGHLIGHT_STYLES[cursor-matchingbracket]='fg=yellow'

# Zsh-vimto configuration
export KEYTIMEOUT=20

# Fzf-marks configuration
export FZF_MARKS_FILE=${QDOTS_ZSH_LOCALSHARE_DIR}/fzf-marks

# Zshell options
[ -f "$QDOTS_ZSH_CONF_DIR/.zshrc-options" ] && source "$QDOTS_ZSH_CONF_DIR/.zshrc-options"

# Plugins: fzf-makrs
# see: run_once_zsh_setup.sh
# need to be after sourcing .zshrc-options
# activation ZSH's completion system have to be done before sourcing the plugin
[[ -d ${QDOTS_ZSH_CACHE_PLUGS_DIR}/fzf-marks ]] && source ${QDOTS_ZSH_CACHE_PLUGS_DIR}/fzf-marks/fzf-marks.plugin.zsh

# Source aliases
[ -f "$QDOTS_CONF_DIR/aliases" ] && source "$QDOTS_CONF_DIR/aliases"

# Qnnb
readonly qnnbSourcePath="${QDOTS_USER_QNNB_ROOT}/.sh/qnnb-source-this.sh"
sourceQnnb() {
  if [ -f "${qnnbSourcePath}" ]; then
   source "${qnnbSourcePath}"
  else
    _echoIt 'Not found qnnb-source-this.sh script. Not installed? Try: install-qnnb' "${_pic}"
    _echoIt ' ... or turn it off by commenting out qnnb section in the .zshrc ' "${_pic}"
  fi
}
sourceQnnb
